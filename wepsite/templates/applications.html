{% extends "base.html" %}
{% block title %}Your Applications{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/applications.css') }}">
{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="applications-hero"> 
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="hero-content">
                    <h1 class="hero-title">
                        {% if current_user.is_admin %}
                            Adoption Applications 📋
                        {% else %}
                            Your Applications 📋
                        {% endif %}
                    </h1>
                    <p class="hero-subtitle">
                        {% if current_user.is_admin %}
                            Manage applications for your posted pets
                        {% else %}
                            Track your adoption journey and connect with rescuers
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Main Applications Section -->
<section class="main-section">
    <div class="container">
        <!-- Floating decorative elements -->
        <div class="floating-element">🐱</div>
        <div class="floating-element">📝</div>
        <div class="floating-element">💌</div>
        
        <div class="row justify-content-center">
            <div class="col-12">
                <div class="applications-container">
                    {% if current_user %}
                        <h2 class="section-title">
                            {% if current_user.is_admin %}
                                <span class="user-greeting">Admin</span> - Applications for Your Pets
                            {% else %}
                                <span class="user-greeting">{{current_user.first_name}}</span>'s Adoption Applications
                            {% endif %}
                        </h2>
                    {% else %}
                        <h2 class="section-title">Adoption Applications</h2>
                    {% endif %}
                    
                    {% if applications %}
                        <div class="table-container">
                            <table class="applications-table">
                                <thead>
                                    <tr>
                                        <th>🐾 Pet Information</th>
                                        <th>👤 {{ 'Applicant' if current_user.is_admin else 'Application' }}</th>
                                        <th>📊 Status</th>
                                        <th>💬 Messages</th>
                                        <th>⚡ Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for app in applications %}
                                        <tr>
                                            <td>
                                                <div class="pet-info">
                                                    <div class="pet-details">
                                                        {% if app.pet and not app.pet.is_deleted %}
                                                            <h6>
                                                                <a href="{{ url_for('views.pet_detail', pet_id=app.pet.id) }}" style="text-decoration: none;">
                                                                    {{ app.pet.name }}
                                                                </a>
                                                            </h6>
                                                            <small>{{ app.pet.breed }} • {{ app.pet.age }}</small>
                                                        {% else %}
                                                            <h6 style="color: #6c757d;">📁 Archived Pet</h6>
                                                            <small>Pet no longer available</small>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                            </td>
                                            <td>
                                                {% if current_user.is_admin %}
                                                    <strong>{{ app.user.first_name }} {{ app.user.last_name }}</strong><br>
                                                    <small>{{ app.user.email }}</small>
                                                {% else %}
                                                    <small>Applied: {{ app.created_at.strftime('%b %d, %Y') if app.created_at else 'N/A' }}</small>
                                                {% endif %}
                                            </td>
                                            <td>
                                                <span class="status-badge status-{{ app.status }}">
                                                    {% if app.status == 'pending' %}⏳{% endif %}
                                                    {% if app.status == 'approved' %}✅{% endif %}
                                                    {% if app.status == 'rejected' %}❌{% endif %}
                                                    {% if app.status == 'archived' %}📁{% endif %}
                                                    {{ app.status|title }}
                                                </span>
                                            </td>
                                            <td>
                                                {% if app.unread and app.unread > 0 %}
                                                    <span class="unread-indicator">{{ app.unread }}</span> new
                                                {% else %}
                                                    <span style="color: #6c757d;">—</span>
                                                {% endif %}
                                            </td>
                                            <td>
                                                <div class="action-buttons">
                                                    <!-- View Messages Button -->
                                                    <a href="{{ url_for('views.messages', application_id=app.id) }}" class="btn-custom btn-view">
                                                        💬 Messages
                                                        {% if app.unread and app.unread > 0 %}
                                                            <span class="unread-indicator">{{ app.unread }}</span>
                                                        {% endif %}
                                                    </a>

                                                    {% if app.status != 'archived' %}
                                                        <!-- Admin-only action buttons -->
                                                        {% if current_user.is_admin and app.pet.posted_by == current_user.id %}
                                                            {% if app.status == 'pending' %}
                                                                <a href="{{ url_for('views.update_application_status', application_id=app.id, status='approved') }}" 
                                                                   class="btn-custom btn-approve" 
                                                                   onclick="return confirm('Approve this application?')">
                                                                     Approve
                                                                </a>
                                                                <a href="{{ url_for('views.update_application_status', application_id=app.id, status='rejected') }}" 
                                                                   class="btn-custom btn-reject" 
                                                                   onclick="return confirm('Reject this application?')">
                                                                     Reject
                                                                </a>
                                                            {% endif %}
                                                        {% endif %}

                                                        <!-- Delete button for both admin and user -->
                                                        {% if (current_user.is_admin and app.pet.posted_by == current_user.id) or current_user.id == app.user_id %}
                                                            <a href="{{ url_for('views.delete_application', application_id=app.id) }}" 
                                                               class="btn-custom btn-delete" 
                                                               onclick="return confirm('Are you sure you want to delete this application? This action cannot be undone.')">
                                                                🗑️ Delete
                                                            </a>
                                                        {% endif %}
                                                    {% else %}
                                                        <!-- Archived status -->
                                                        <span class="archived-text">📁 Archived</span>
                                                    {% endif %}
                                                </div>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <!-- Empty State -->
                        <div class="empty-state">
                            <div class="empty-state-icon">🐱</div>
                            <h3 class="empty-state-title">
                                {% if current_user.is_admin %}
                                    No Applications Yet
                                {% else %}
                                    No Applications Yet
                                {% endif %}
                            </h3>
                            <p class="empty-state-text">
                                {% if current_user.is_admin %}
                                    No one has applied for your posted pets yet.<br>
                                    Keep sharing your pets to find them loving homes!
                                {% else %}
                                    You haven't submitted any adoption applications yet.<br>
                                    Browse available pets and start your adoption journey!
                                {% endif %}
                            </p>
                            <div style="margin-top: 20px;">
                                <a href="{{ url_for('views.home') }}" class="btn-custom btn-view">
                                    Browse Pets
                                </a>
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}